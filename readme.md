# Tokopedia Play (Backend Only)

The Tokopedia Play Backend API is a RESTful API server built using NodeJS with ExpressJS as a framework and MongoDB as a NoSQL database. This API server is made as a midterm assignment for GIGIH 3.0 Fullstack Track. It provides various endpoints to manage video thumbnail lists, product lists, comments, and the ability to submit comments for videos. This API Server is connected and used by this [Tokopedia Play React Clone](https://github.com/rizkyyusfian/tokopediaplay-react).

## Deployment

The application is deployed on **Railway** using [deploy-railway branch](https://github.com/rizkyyusfian/tokopediaplay/tree/deploy-railway). You can access the root endpoint app using the following link: [Root Endpoint](https://tokopediaplay.up.railway.app/).

The online database is using MongoDB cloud service, MongoDB Atlas.

## Database Structure

This system uses a NoSQL MongoDB database to store various data related to videos, products, and comments. All the data is stored in one collection, with productList and commentList stored as **embedded document** inside the video document. The schematic is as follows:

- `_id`: ObjectId
- `title`: String
- `imageThumbnailUrl`: String
- `videoUrl`: String
- `productList`: Array of objects containing:
  - `_id`: ObjectId
  - `name`: String
  - `price`: Number
  - `link`: String
- `commentList`: Object containing:
  - `_id`: ObjectId
  - `userName`: String
  - `comment`: String
  - `createdAt`: Date
  - `updatedAt`: Date
- `createdAt`: Date
- `updatedAt`: Date


Another User Collection is made for storing user data used for authentication. The schematic is as follows:
- `_id`: ObjectId
- `userNmae`: String
- `email`: String
- `password`: String
- `profilePicture`: String
- `createdAt`: Date
- `updatedAt`: Date

#### Schema Explanation (Video Collection)
The video collection stores information about various videos available on the platform. Each document represents a single video and includes details such as the video title, URL link to the video's thumbnail image, a URL link to the video, an array of associated products (productList), a list of comments (commentList), and a timestamp.

- `_id`: The unique identifier for each video document, automatically generated by MongoDB.
- `title`: The title of the video.
- `imageThumbnailUrl`: The URL link to the thumbnail image of the video.
- `videoUrl`: The URL link to the video.
- `productList`: An array of objects containing information about the products associated with the video. Each object includes the product's title, price, and link to the product page.
- `commentList`: An object containing details of the latest comment made on the video, including the user's name and the comment text.
- `createdAt`: The timestamp indicating when the document was created.
- `updatedAt`: The timestamp indicating when the document was last updated.

##### Array of objects productList:
Stores information about the products available for sale on the platform. Each object represents a single product and is related to videos. it includes details such as the product title, price, and link to the product page.
- `_id`: The unique identifier for each product document, automatically generated by MongoDB.
- `title`: The title of the product.
- `price`: The price of the product.
- `link`: The URL link to the product page.
- `createdAt`: The timestamp indicating when the document was created.
- `updatedAt`: The timestamp indicating when the document was last updated.

##### Array of objects commentList:
Stores user comments on videos. Each object represents a single comment and includes details such as the user's name, the comment text, and timestamps for creation and update.

- `_id`: The unique identifier for each comment document, automatically generated by MongoDB.
- `userName`: The user name who made the comment.
- `comment`: The text of the comment.
- `createdAt`: The timestamp indicating when the comment was created.
- `updatedAt`: The timestamp indicating when the comment was last updated.

#### Schema Explanation (User Collection)
The user collection stores information about the user information that is already registered. Each document represents a single user credential which includes details such as the user name, email, password, and profile picture path file.

- `_id`: The unique identifier for each video document, automatically generated by MongoDB.
- `userName`: Account user name.
- `email`: User account email
- `password`: User account password.
-  `profilePicture`: The path to the user picture location.
- `createdAt`: The timestamp indicating when the document was created.
- `updatedAt`: The timestamp indicating when the document was last updated.

## API Structure

This project implements an Express.js API server to build a Tokopedia Play clone. The API provides several endpoints to handle video thumbnail lists, product lists, comments, and the ability to submit comments for videos. below is the list of API requests and responses:

### GET /
Return all video thumbnail lists in the system
* **URL Params**  
  None
* **Data Params**  
  None
* **Headers**  
  Content-Type: application/json  
* **Success Response:**  
* **Code:** 200  
  
  **Content:** 
  ```
  {
    "videoList": [
      {
        "_id": string,
        "imageThumbnailUrl": String
        "videoUrl: String
      },
    ]
  }
  ``` 

* **Error Response:**  
* **Code:** 500  
  
  **Content:** 
  ```
  "Failed to get product list, Error Message:" + error.message
  ```

### GET /product/:id
Return all product lists in the system based on video id
* **URL Params**  
  *Required:* `id=[integer]`
* **Data Params**  
  None
* **Headers**  
  Content-Type: application/json  
* **Success Response:**  
* **Code:** 200  
  
  **Content:** 
  ```
  {
    "productList": [
      {
        "_id": string,
        "name": string,
        "price": integer,
        "link": string
      },
    ]
  }
  ``` 

* **Error Response:**  
* **Code:** 500  
  
  **Content:** 
  ```
  "Failed to get product list, Error Message:" + error.message
  ```

### GET /comment/:id
Return all comment lists in the system based on video id
* **URL Params**  
  *Required:* `id=[integer]`
* **Data Params**  
  None
* **Headers**  
  Content-Type: application/json  
* **Success Response:**  
* **Code:** 200  
  
  **Content:** 
  ```
  {
    "commentList": [
      {
        "userName": string,
        "comment": string,
        "createdAt": ISODate,
        "updatedAt": ISODate
      },
    ]
  }
  ``` 

* **Error Response:**  
* **Code:** 500  
  
  **Content:** 
  ```
  "Failed to get comment list, Error Message:" + error.message
  ```

### POST /comment/:id
Submit a comment to specific videos based on video id
* **URL Params**  
  *Required:* `id=[integer]`
* **Data Params**  
  ```
  {
    "userName": string,
    "comment": string
  }
  ```
* **Headers**  
  Content-Type: application/json  
* **Success Response:**  
* **Code:** 201 
  
  **Content:** 
  ```
  "Comment Successfully Added"
  ``` 

* **Error Response:**  
* **Code:** 400

  **Content:** 
  ```
  "Failed to add a comment, Error Message:" + error.message
  ```

## POST /login
Authenticate a user when logged in
* **URL Params**  
  None
* **Data Params**  
  ```
  {
    "email": string,
    "password": string
  }
  ```
* **Headers**  
  Content-Type: application/json  
* **Success Response:**  
* **Code:** 200
  
  **Content:** 
  ```
    {
    "_id": ObjectID,
    "userName": string,
    "email": string,
    "password": string,
    "profilePicture": string,
    "createdAt": ISODate,
    "updatedAt": ISODate
  }
  ``` 

* **Error Response:**  
* **Code:** 400

  **Content:** 
  ```
  "Invalid Credential"
  ```

## GET /search
Search video using a keyword
* **URL Params**  
  ```
  {
    key: q
    value: keyword
  }
  ```
* **Data Params**  
  None
* **Headers**  
  Content-Type: application/json  
* **Success Response:**  
* **Code:** 200
  
  **Content:** 
  ```
  {
    "videoList": [
          {
            "_id": string,
            "imageThumbnailUrl": String
            "videoUrl: String
          },
      ]
  }
  ``` 

* **Error Response:**  
* **Code:** 500

  **Content:** 
  ```
  Failed to search video, Error Message: " + error.message
  ```

## How to run locally
To run the Tokopedia Play Backend API server locally, follow these steps:

Clone the project. Make sure that you clone the **master** branch

```
  git clone https://github.com/rizkyyusfian/tokopediaplay.git
```

Go to the project directory

```
  cd tokopediaplay
```

Install dependencies

```
  npm install
```

Start the server

```
  npm start
```

The API server will start running at `http://localhost:8000`. Use the specified endpoints to interact with the API and retrieve video thumbnail lists, product lists, and comments.

## Additional Notes
The database used in this project can be found in the `database` folder. file consists of a JS file that can be used to insert video collection and JSON file of user and video collection.

**List of user accounts used for login:**
```
email: windah@gmail.com
password: windah123
```

```
email: lisa@gmail.com
password: lisa123
```

```
email: sammy@gmail.com
password: sammy123
```

## License

This project is licensed under the [MIT License](LICENSE).
